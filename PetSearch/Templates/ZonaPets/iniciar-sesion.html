{% extends "ZonaPets/barsiteapp.html" %}
{% load static %}
{% block content %}
{% load static %}
<!doctype html>
<html lang="es">

<head>
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>¡Inicia sesion! | ZonaPets</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <link rel="icon" type="image/png" href="{% static 'imagenes/iconfav.png' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/iniciarsesion.css/' %}">
</head>

<body>
    <div id="app"></div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const app = document.getElementById('app');
            let currentUser = false;

            function checkUserStatus() {
                axios.get("https://zonapets.vercel.app/api/user/", { withCredentials: true })
                    .then(function (response) {
                        currentUser = true;
                        renderApp();
                    })
                    .catch(function (error) {
                        currentUser = false;
                        renderApp();
                    });
            }

            function renderApp() {
                app.innerHTML = '';

                if (!currentUser) {
                    redirectToSignupPage();
                } else {
                    renderLoggedInInterface();
                }
            }

            function redirectToSignupPage() {
                const signupInterface = `
                    <div class="containerform" id="move-content" style="">
                        <img src="https://www.shutterstock.com/image-vector/blank-avatar-photo-place-holder-600nw-1095249842.jpg" style="heigth:70px; width:70px; border-radius:50px" >
                        <h1>Es hora de iniciar sesión</h1>
                        <p>¿Aún no tienes una cuenta? </p>
                        <button class="auth-button" onclick="window.location.href='https://zonapets.vercel.app/micuenta/'">Inicia Sesión</button>
                    </div>`;
                app.innerHTML = signupInterface;
            }

            function renderLoggedInInterface() {
                const loggedInInterface = `
                    <div class="containerform" id="move-content">
                        <h1 class="post-login">¡Has iniciado sesión!</h1>
                    </div>`;
                app.innerHTML = loggedInInterface;
            }

            // Inicialización
            checkUserStatus();

            // Hacer funciones globales para acceso desde HTML
            window.submitLogin = submitLogin;

            // Opcional: mover esta función al final si no se necesita de inmediato
            window.updateFormBtn = updateFormBtn;
        });

        // Configuración de Axios
        axios.defaults.xsrfCookieName = "csrftoken";
        axios.defaults.xsrfHeaderName = "X-CSRFToken";
        axios.defaults.withCredentials = true;

        // Aquí puedes agregar la función `updateFormBtn()` si aún es necesaria.

        document.getElementById("icon-menu").addEventListener("click", mostrar_menu);

    </script>
</body>

</html>
{% endblock %}